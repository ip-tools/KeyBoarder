/**
  author:       Lo Sauer 2011 (c); github.com/lsauer/KeyBoarder
  project:      KeyBoarder
  description:  keyBoarder is a small, fast javascript library for dynamically rendering visually appealing, navigatable keyboard shortcuts.
  license:      MIT license (= commercial use is ok)
*/
kbparams={clsNames:["content"],isDebug:false,safeMode:false,concatenator:"+",matchAtLeast:0,keyHtmlElem:"kbd",isStartCasing:true,isBothCasing:true,stripPunctuation:true,KEYMAP:{UPPERCASE:0,Startcase:0,STRG:16,CTRL:17,CTRLRIGHT:18,CTRLR:18,SHIFT:16,RETURN:13,ENTER:13,BACKSPACE:8,BCKSP:8,ALT:18,SPACE:32,TAB:9,WIN:91,INSERT:0,END:0,PAGE:0,HOME:0,MAC:91,FN:null,UP:38,DOWN:40,LEFT:37,RIGHT:39,ESC:27,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PUNCTALNUM:36}};isOpera=/opera/i.test(navigator.userAgent)?true:false;Classy=function(a){if(a&&a.constructor===String){a=document.getElementsByClassName(a)[0]}var b=a;return{self:a,set:function(a){if(!a.length){this.self=a}else{this.self=a[0];b=a}return this},foreach:function(a,b,c){for(var d=0;d<b.length;d++){c(a,b[d])}},has:function(a,b){if(this.self){b=this.self}var c=new RegExp("(^|\\s)"+a+"(\\s?)");return b.className.match(c)},add:function(a,b){if(this.self){b=this.self}if(!this.has(a,b)){b.className+=" "+a}return this},del:function(a,b){if(this.self){b=this.self}if(this.has(a,b)){var c=new RegExp("(^|\\s)"+a+"(\\s?)");b.className=b.className.replace(c," ")}return this},repl:function(a,b,c){if(this.self){c=this.self}if(this.has(a,c)){this.del(a,c)}this.add(b,c);return this},focus:function(a){if(this.self){a=this.self}var b=100;var c={x:0,y:0};while(a!=null){c.x+=a.offsetLeft;c.y+=a.offsetTop;a=a.offsetParent}window.scrollTo(c.x,c.y)},prototype:{toString:function(){return JSON.stringify(self)}}}};with(window&&window.console&&window.console._commandLineAPI||{}){var KeyBoarder=function(){function m(a){if(a===null){return"undefined"}return String.fromCharCode(a)}var a=new Classy;var b={backspace:"8",tab:"9",enter:"13",shift:"16",ctrl:"17",alt:"18",pause_break:"19",caps_lock:"20",escape:"27",page_up:"33","page down":"34",end:"35",home:"36",left_arrow:"37",up_arrow:"38",right_arrow:"39",down_arrow:"40",insert:"45","delete":"46",0:"48",1:"49",2:"50",3:"51",4:"52",5:"53",6:"54",7:"55",8:"56",9:"57",a:"65",b:"66",c:"67",d:"68",e:"69",f:"70",g:"71",h:"72",i:"73",j:"74",k:"75",l:"76",m:"77",n:"78",o:"79",p:"80",q:"81",r:"82",s:"83",t:"84",u:"85",v:"86",w:"87",x:"88",y:"89",z:"90","left_window key":"91","right_window key":"92",select_key:"93","numpad 0":"96","numpad 1":"97","numpad 2":"98","numpad 3":"99","numpad 4":"100","numpad 5":"101","numpad 6":"102","numpad 7":"103","numpad 8":"104","numpad 9":"105",multiply:"106",add:"107",subtract:"109","decimal point":"110",divide:"111",f1:"112",f2:"113",f3:"114",f4:"115",f5:"116",f6:"117",f7:"118",f8:"119",f9:"120",f10:"121",f11:"122",f12:"123",num_lock:"144",scroll_lock:"145",semi_colon:"186",equal_sign:"187",comma:"188",dash:"189",period:"190",forward_slash:"191",grave_accent:"192",open_bracket:"219",backslash:"220",closebracket:"221",single_quote:"222"};var c={clsNames:["content","claro"],isDebug:false,safeMode:false,concatenator:"+",matchAtLeast:0,keyHtmlElem:"kbd",isStartCasing:true,isBothCasing:true,stripPunctuation:true,KEYMAP:{STRG:17,CTRLRIGHT:18,CTRLR:18,SHIFT:16,RETURN:13,ENTER:13,BACKSPACE:8,BCKSP:8,ALT:18,ALTRIGHT:17,SPACE:32,WIN:91,MAC:91,FN:null,UP:38,DOWN:40,LEFT:37,RIGHT:39,ESC:27,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123}};var d=.6;var e="20/08/2011";var f="initial release";var g=[];var h={};var i={};var j=function(a){if(!c.isStartCasing)return a;else return a.toUpperCase()[0]+a.substr(1,a.length).toLowerCase()};isKeyBoarder=true;var k=function(){return[f,": <",d,">"].join("")};var l=function(a){this.self=this;if(arguments.length===0){var a={}}for(var d in a){c[d]=a[d]}for(var d in c.KEYMAP){g.push(j(d));if(c.isBothCasing)g.push(d.toUpperCase())}c.KEYMAP.__proto__=b;for(var d in c.KEYMAP){h[d.toLowerCase()]=0;i[c.KEYMAP[d]]=d}var e=document.getElementsByTagName("body")[0];e.addEventListener("keydown",KeyBoarder.highlightKeys);e.addEventListener("keyup",KeyBoarder.highlightKeys);var f=g.join("|");if(!c.safeMode){var k=c.matchAtLeast?"+":"?";var l=new RegExp("[\\s|,\\-]?((?:"+f+"|F\\d\\d?\\s)\\s*\\"+c.concatenator+k+"\\s*){1,4}([A-Z0-9\\*\\+\\-](\\s*\\+\\s*[A-Z0-9])?|[A-Z0-9]\\"+c.concatenator+"[A-Z0-9]?){0,1}(?:[,\\s\\\"\\'<\\/])","g")}else{var l=/[\s|,]?((?:STRG|CTRL|SHIFT|RETURN|ENTER|ALT|ALTR|SPACE|WIN|FN|UP|DOWN|LEFT|RIGHT|ESC|DEL)\s{0,2}\+\s?){1,2}[A-Z0-9][,]?\s/g}if(c.isDEBUG)console.log(l);var m=new Array(l);var n=function(a){if(c["isDebug"]){console.log("matches:",a)}if(a.indexOf(c.concatenator)===-1&&g.indexOf(a.trim())===-1)return a;var b;if(c.matchAtLeast&&(b=a.match(RegExp("\\"+c.concatenator,"g")))!==null&&b.length<c.matchAtLeast)return a;a=a.toString();if(c.stripPunctuation)a=a.replace(RegExp(",|\\\"|\\-|\\'|\\*|\\#|\\\\|\\;|\\:|\\||\\.|\\!|\\$|\\&|\\%","g"),"");var d,e="";concat='<b class="kbConcat">'+c.concatenator+"</b>";if(a[a.length-1]==="<"){a=a.substr(0,a.length-1);e="<"}var f=c.keyHtmlElem;if(a.indexOf(c.concatenator)>-1){d=a.split(RegExp("\\s*\\"+c.concatenator+"\\s*"));for(var h=0;h<d.length;h++){d[h]="<"+f+' class="kbKey kb'+d[h].toString().toUpperCase().trim()+'">'+d[h].toString().trim()+"</"+f+">"}d=d.join(concat)}else{d="<"+f+' class="kbKey kb'+a.toUpperCase().trim()+'">'+a.trim()+"</"+f+">"}return d.replace(/,|\-/g,"")+e};this.regmatch=n;this.htmlproptext="";var o=function(){for(var a=0;a<c.clsNames.length;a++){var b=document.getElementsByClassName(c.clsNames[a])[0];for(var d=0;d<b.length;d++){var e=c.clsNames[a]+","+d;if(typeof el==="undefined")continue;if(typeof self.originaltext[e]!=="undefined"){el[self.htmlproptext]=self.originaltext[e];return true}else{return false}}}};this.restore=o;var p=function(){if(arguments.length>0){if(a.constructor===String){c.clsNames.push(a)}else if(a.constructor===Object){c.clsNames=a["clsNames"]}else{throw new TypeError("unexpected Object passed to constructor")}}var b="g";for(var d=0;d<c.clsNames.length;d++){var e=document.getElementsByClassName(c.clsNames[d]);for(var f=0;f<e.length;f++){var g=e[f];if(typeof g==="undefined")continue;if(typeof this.originaltext==="undefined"){this.originaltext={}}var h=c.clsNames[d]+","+f;if(typeof this.originaltext[h]!=="undefined"){var i=this.originaltext[h]}else{var i=g.innerHTML||g.innerText||g.value;this.originaltext[h]=i}this.regmatch="";for(var j=0;j<m.length;j++){i=i.replace(m[j],function(){return n(arguments[0])})}if(c["isDebug"]){console.log(i)}var k=10;if(typeof g.innerHTML!=="undefined"){this.htmlproptext="innerHTML";if(Math.abs(g.innerHTML.length-i.length)>k)g.innerHTML=i}else if(typeof g.innerText!=="undefined"){this.htmlproptext="innerText";if(Math.abs(g.innerText.length-i.length)>k)g.innerText=i}else if(typeof g.value!=="undefined"){this.htmlproptext="value";if(Math.abs(g.value.length-i.length)>k)g.value=i}else return false}}return true};this.init=p;this.intStatus=p();this.reinit=p};l.highlightKeys=function(b){var d=b.keyCode?b.keyCode:b.charCode;if(c["isDebug"]){console.log(d,b.ctrlKey,b)}if(b.type==="keydown"){if(c["isDebug"])console.log(KeyBoarder.keyCodeToKey(b.keyCode),i);if(keylit=KeyBoarder.keyCodeToKey(b.keyCode)){var e=h[keylit];var f=document.getElementsByClassName("kb"+keylit.toUpperCase());if(!f.length)return;a.add("kbKeyHighlight",f[e]).focus(f[e]);if(h[keylit]+1<f.length)h[keylit]++;else h[keylit]=0}}else if(b.type==="keyup"){if(keylit=KeyBoarder.keyCodeToKey(b.keyCode)){var f=document.getElementsByClassName("kb"+keylit.toUpperCase());if(!f.length)return;var e=h[keylit]===0?f.length-1:h[keylit]-1;a.del("kbKeyHighlight",f[e])}}b.cancelBubble=true};l.keyCodeToKey=function(a){return i[a].toLowerCase()};l.prototype={toString:function(){return k()}};return l}()}(function(a){var b=document.getElementsByTagName("script");for(var c=0;c<b.length;c++){if(/KeyBoarder/ig.test(b[c].src)){};}if(typeof KeyBoarder==="undefined"){throw new TypeError("A variable or object with the name KeyBoarder does not (yet) exist in the global scope.")}else{window.addEventListener("error",function(a){console.error("KeyBoarder-Error:",a)});if(/opera/i.test(navigator.userAgent))window.addEventListener("DOMContentLoaded",function(a){var b=new KeyBoarder(kbparams)},null);else window.addEventListener("load",function(a){var b=new KeyBoarder(kbparams)})}})(window)